<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æµ‹è¯•æœåŠ¡å¼€å‘é¡µé¢</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        button { padding: 8px 16px; margin: 5px; cursor: pointer; }
        #results { background: #f5f5f5; padding: 10px; border-radius: 5px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>æœåŠ¡å¼€å‘é¡µé¢æµ‹è¯•å·¥å…·</h1>
    
    <div class="test-section">
        <h3>æµ‹è¯•æ­¥éª¤</h3>
        <ol>
            <li>ç¡®ä¿åº”ç”¨ç¨‹åºè¿è¡Œåœ¨ http://localhost:8080</li>
            <li>ç‚¹å‡»ä¸‹é¢çš„é“¾æ¥æ‰“å¼€æœåŠ¡å¼€å‘é¡µé¢</li>
            <li>ç™»å½•è´¦å·ï¼šadmin / admin123</li>
            <li>åˆ›å»ºæ–°æœåŠ¡æˆ–é€‰æ‹©ç°æœ‰æœåŠ¡</li>
            <li>æ£€æŸ¥ç¼–è¾‘å™¨æ˜¯å¦æ­£å¸¸æ˜¾ç¤º</li>
            <li>æ£€æŸ¥å‚æ•°é…ç½®é¢æ¿æ˜¯å¦æ­£å¸¸</li>
        </ol>
    </div>
    
    <div class="test-section">
        <h3>ç›¸å…³é¡µé¢é“¾æ¥</h3>
        <a href="http://localhost:8080/web-frontend/login.html" target="_blank">
            <button>ğŸšª ç™»å½•é¡µé¢</button>
        </a>
        <a href="http://localhost:8080/web-frontend/dashboard.html" target="_blank">
            <button>ğŸ“Š ä»ªè¡¨ç›˜</button>
        </a>
        <a href="http://localhost:8080/web-frontend/service-development.html" target="_blank">
            <button>âš¡ æœåŠ¡å¼€å‘é¡µé¢ (ä¸»è¦æµ‹è¯•)</button>
        </a>
        <a href="http://localhost:8080/web-frontend/apiservice-table.html" target="_blank">
            <button>ğŸ“‹ APIæœåŠ¡åˆ—è¡¨</button>
        </a>
    </div>
    
    <div class="test-section">
        <h3>æµ‹è¯•APIç«¯ç‚¹</h3>
        <button onclick="testLogin()">ğŸ”‘ æµ‹è¯•ç™»å½•API</button>
        <button onclick="testDataSources()">ğŸ’¾ æµ‹è¯•æ•°æ®æºAPI</button>
        <button onclick="testServices()">âš™ï¸ æµ‹è¯•æœåŠ¡API</button>
        <button onclick="createTestService()">â• åˆ›å»ºæµ‹è¯•æœåŠ¡</button>
    </div>
    
    <div id="results"></div>
    
    <script>
        const API_BASE_URL = 'http://localhost:8080';
        let authToken = null;
        
        function log(message) {
            const results = document.getElementById('results');
            results.innerHTML += `[${new Date().toLocaleTimeString()}] ${message}<br>`;
            results.scrollTop = results.scrollHeight;
            console.log(message);
        }
        
        async function makeRequest(url, options = {}) {
            try {
                const response = await fetch(url, options);
                const data = await response.json();
                return { status: response.status, data };
            } catch (error) {
                return { status: 0, error: error.message };
            }
        }
        
        async function testLogin() {
            log('ğŸ”‘ æµ‹è¯•ç™»å½•...');
            const result = await makeRequest(`${API_BASE_URL}/api/auth/login`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username: 'admin', password: 'admin123' })
            });
            
            if (result.data && result.data.success) {
                authToken = result.data.data.token;
                log('âœ… ç™»å½•æˆåŠŸï¼ŒTokenå·²è·å–');
            } else {
                log('âŒ ç™»å½•å¤±è´¥: ' + (result.data?.message || result.error));
            }
        }
        
        async function testDataSources() {
            if (!authToken) {
                log('âš ï¸ è¯·å…ˆç™»å½•');
                return;
            }
            
            log('ğŸ’¾ æµ‹è¯•æ•°æ®æºAPI...');
            const result = await makeRequest(`${API_BASE_URL}/api/datasources`, {
                headers: {
                    'Authorization': `Bearer ${authToken}`,
                    'Content-Type': 'application/json'
                }
            });
            
            if (result.data && result.data.success) {
                log(`âœ… æ•°æ®æºAPIæ­£å¸¸ï¼Œå…±${result.data.data.length}ä¸ªæ•°æ®æº`);
                result.data.data.forEach(ds => {
                    log(`   - ${ds.name}: ${ds.type}`);
                });
            } else {
                log('âŒ æ•°æ®æºAPIå¤±è´¥: ' + (result.data?.message || result.error));
            }
        }
        
        async function testServices() {
            if (!authToken) {
                log('âš ï¸ è¯·å…ˆç™»å½•');
                return;
            }
            
            log('âš™ï¸ æµ‹è¯•æœåŠ¡API...');
            const result = await makeRequest(`${API_BASE_URL}/api/services`, {
                headers: {
                    'Authorization': `Bearer ${authToken}`,
                    'Content-Type': 'application/json'
                }
            });
            
            if (result.data && result.data.success) {
                const services = result.data.data.content || result.data.data || [];
                log(`âœ… æœåŠ¡APIæ­£å¸¸ï¼Œå…±${services.length}ä¸ªæœåŠ¡`);
                services.forEach(svc => {
                    log(`   - ${svc.name}: ${svc.method} ${svc.path}`);
                });
            } else {
                log('âŒ æœåŠ¡APIå¤±è´¥: ' + (result.data?.message || result.error));
            }
        }
        
        async function createTestService() {
            if (!authToken) {
                await testLogin();
                if (!authToken) return;
            }
            
            log('â• åˆ›å»ºæµ‹è¯•æœåŠ¡...');
            const serviceData = {
                name: 'æµ‹è¯•æœåŠ¡_' + Date.now(),
                description: 'é€šè¿‡æµ‹è¯•å·¥å…·åˆ›å»ºçš„æœåŠ¡',
                path: '/api/test_' + Date.now(),
                method: 'GET',
                dataSourceId: 1,
                sqlContent: 'SELECT COUNT(*) as total FROM users',
                requestParams: '{}',
                responseExample: '{}',
                enabled: true
            };
            
            const result = await makeRequest(`${API_BASE_URL}/api/services`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${authToken}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(serviceData)
            });
            
            if (result.data && result.data.success) {
                const newService = result.data.data;
                log(`âœ… æœåŠ¡åˆ›å»ºæˆåŠŸ: ${newService.name} (ID: ${newService.id})`);
                log(`   ç°åœ¨å¯ä»¥åœ¨æœåŠ¡å¼€å‘é¡µé¢é€‰æ‹©æ­¤æœåŠ¡è¿›è¡Œç¼–è¾‘`);
            } else {
                log('âŒ æœåŠ¡åˆ›å»ºå¤±è´¥: ' + (result.data?.message || result.error));
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æµ‹è¯•ç™»å½•
        window.onload = function() {
            log('ğŸš€ æµ‹è¯•å·¥å…·å·²åŠ è½½');
            testLogin();
        };
    </script>
</body>
</html>